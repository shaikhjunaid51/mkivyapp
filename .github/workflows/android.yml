name: Build APK

on:
push:
branches: [ main ]
workflow_dispatch:

jobs:
build:
runs-on: ubuntu-22.04

steps:
  - name: Checkout
    uses: actions/checkout@v4

  - name: Install dependencies
    run: |
      sudo apt-get update
      sudo apt-get install -y python3-pip git zip unzip openjdk-17-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev cmake libffi-dev libssl-dev

  - name: Install Buildozer
    run: |
      python3 -m pip install --upgrade pip
      pip install cython==0.29.33
      pip install buildozer

  - name: Build APK
    run: |
      buildozer android debug

  - name: Upload APK
    uses: actions/upload-artifact@v4
    with:
      name: apk
      path: bin/*.apk
